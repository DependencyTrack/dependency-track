<%@page import="alpine.Config" %>
<%@page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@taglib prefix="e" uri="https://www.owasp.org/index.php/OWASP_Java_Encoder_Project" %>
<%!
    private static final String BUILD_ID = Config.getInstance().getApplicationBuildUuid();
    private static final String VERSION_PARAM = "?v=" + BUILD_ID;
%>
<!DOCTYPE html>
<html lang="en">
<head>
    <jsp:include page="/WEB-INF/fragments/header.jsp"/>
    <title>Dependency-Track - Vulnerability</title>
</head>
<body data-sidebar="vulnerabilities">
<jsp:include page="/WEB-INF/fragments/navbar.jsp"/>
<div id="content-container" class="container-fluid require-view-portfolio">
    <div class="content-row main">

        <div class="col-lg-8 col-md-6">
            <h2 id="vulnId"></h2>
            <span><strong>Source</strong>: <span class="vuln-source"></span></span>

            <div style="height:40px;">
                <div class="severity-color text-center pull-left" style="width:40px; height:40px; color:#ffffff">
                    <i class="fa fa-bug" style="font-size:20px; padding:10px" aria-hidden="true"></i>
                </div>
                <div class="text-center pull-left" style="height:40px; background-color:#21272d; color:#ffffff">
                    <div style="font-size:20px; padding:6px"><span class="severity-value"></span></div>
                </div>
            </div>

            <div id="vulndata"></div>

            <h3 style="margin-top:50px;">Affected Projects</h3>
            <div class="panel with-nav-tabs panel-default tight">
                <div class="panel-heading">
                    <ul class="nav nav-tabs">
                        <li><a href="#excludeSuppressionTab" data-toggle="tab"><i
                                class="fa fa-tasks"></i> Exclude Suppression</a></li>
                        <li><a href="#includeSuppressionTab" data-toggle="tab"><i
                                class="fa fa-tasks"></i> Include Suppression</a></li>
            
                    </ul>
                </div>
                <div class="panel-body tight">
                    <div class="tab-content">
                        <div class="tab-pane active" id="excludeSuppressionTab">
                            <table id="vulnerableProjectsTableExcludeSuppression" class="table table-striped"
                                   data-toggle="table"
                                   data-url="<c:url value="/api/v1/vulnerability/source/${e:forUriComponent(param.source)}/vuln/${e:forUriComponent(param.vulnId)}/dependencyAnalysis?includeSuppressed=false"/>"
                                   data-show-refresh="true" data-show-columns="true" data-search="true"
                                   data-query-params-type="pageSize" data-side-pagination="client" data-pagination="true"
                                   data-silent-sort="false" data-page-size="10" data-page-list="[10, 25, 50, 100]"
                                   data-response-handler="formatProjectsTable" data-height="100%">
                                <thead>
                                <tr>
                                    <th data-align="left" data-field="projecthref">Name</th>
                                    <th data-align="left" data-field="version">Version</th>
                                    <th data-align="left" data-field="componentName">Component</th>
                                    <th data-align="left" data-field="lastComment">Comment</th>
                                    <th data-align="left" data-field="analysisState">Analysis State</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                
                        <div class="tab-pane" id="includeSuppressionTab">
                            <table id="vulnerableProjectsTableIncludeSuppression" class="table table-striped"
                                   data-toggle="table"
                                   data-url="<c:url value="/api/v1/vulnerability/source/${e:forUriComponent(param.source)}/vuln/${e:forUriComponent(param.vulnId)}/dependencyAnalysis?includeSuppressed=true"/>"
                                   data-show-refresh="true" data-show-columns="true" data-search="true"
                                   data-query-params-type="pageSize" data-side-pagination="client" data-pagination="true"
                                   data-silent-sort="false" data-page-size="10" data-page-list="[10, 25, 50, 100]"
                                   data-response-handler="formatProjectsTable" data-height="100%">
                                <thead>
                                <tr>
                                    <th data-align="left" data-field="projecthref">Name</th>
                                    <th data-align="left" data-field="version">Version</th>
                                    <th data-align="left" data-field="componentName">Component</th>
                                    <th data-align="left" data-field="lastComment">Comment</th>
                                    <th data-align="left" data-field="analysisState">Analysis State</th>
                                    <th data-align="center" data-field="isSuppressedLabel" data-sortable="true"
                                        data-class="tight">Suppressed
                                    </th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="col-lg-4 col-md-6" style="margin-top:20px">
            <table width="350" cellpadding="0" cellspacing="0" border="0" class="pull-right">
                <tr>
                    <td colspan="3" height="280"><div class="radar-chart-container" style="margin-left:-25px; width:350px; height:290px; overflow:hidden"></div></td>
                </tr>
                <tr>
                    <td align="center">
                            <span id="cvssBaseScorePercent" class="chart" data-percent="0">
                                <span id="cvssBaseScore" class="cvssScoreChartScore"></span>
                            </span>
                        <h4>Base Score</h4>
                    </td>
                    <td align="center">
                            <span id="cvssImpactScorePercent" class="chart" data-percent="0">
                                <span id="cvssImpactScore" class="cvssScoreChartScore"></span>
                            </span>
                        <h4>Impact</h4>
                    </td>
                    <td align="center">
                            <span id="cvssExploitScorePercent" class="chart" data-percent="0">
                                <span id="cvssExploitScore" class="cvssScoreChartScore"></span>
                            </span>
                        <h4>Exploitability</h4>
                    </td>
                </tr>
                <tr class="cvssv3VectorRow">
                    <td colspan="3" style="height:20px">&nbsp;</td>
                </tr>
                <tr class="cvssv3VectorRow">
                    <td colspan="3" style="padding-left:20px">
                        <strong>CVSSv3 vector:</strong><br/>
                        <span id="cvssV3Vector"></span>
                    </td>
                </tr>
                <tr class="cvssv2VectorRow">
                    <td colspan="3" style="height:20px">&nbsp;</td>
                </tr>
                <tr class="cvssv2VectorRow">
                    <td colspan="3" style="padding-left:20px">
                        <strong>CVSSv2 vector:</strong><br/>
                        <span id="cvssV2Vector"></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="3" style="height:20px">&nbsp;</td>
                </tr>
                <tr>
                    <td colspan="3" style="padding-left:20px">
                        <strong>See also:</strong><br/>
                        <a id="vulnSourceUrl" href=""></a> (<span class="vuln-source"></span>)
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<jsp:include page="/WEB-INF/fragments/common-modals.jsp"/>
<jsp:include page="/WEB-INF/fragments/footer.jsp"/>
<script type="text/javascript" src="<c:url value="/vulnerability/functions.js"/><%=VERSION_PARAM%>"></script>
</body>
</html>